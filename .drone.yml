kind: pipeline
name: default

steps:
  # - name: docker-tag-build
  #   image: plugins/docker
  #   settings:
  #     username:
  #       from_secret: DOCKER_USERNAME
  #     password:
  #       from_secret: DOCKER_PASSWORD
  #     repo: jerheij/proxy
  #     no_cache: true
  #     tags: ${DRONE_TAG}
  #   when:
  #     event:
  #       - tag

  # - name: docker-latest-build
  #   image: plugins/docker
  #   settings:
  #     username:
  #       from_secret: DOCKER_USERNAME
  #     password:
  #       from_secret: DOCKER_PASSWORD
  #     repo: jerheij/proxy
  #     no_cache: true
  #     tags: latest
  #   when:
  #     event:
  #       - push
  #     branch:
  #       - master

  # - name: docker-cron-build
  #   image: plugins/docker
  #   settings:
  #     username:
  #       from_secret: DOCKER_USERNAME
  #     password:
  #       from_secret: DOCKER_PASSWORD
  #     repo: jerheij/proxy
  #     no_cache: true
  #     tags: autobuild
  #   when:
  #     event:
  #       - cron
  #     include:
  #       cron:
  #         - hourly

  - name: email_notification
    image: drillster/drone-email
    settings:
      host: 192.168.169.3
      port: 25
      subject: "Drone Build {{repo.name}}/{{tag}} {{build.status}}"
      body: >
        Repo: {{repo.fullName}}
        <p>Branch: {{repo.branch}}</p>
        <p>Tag: {{tag}}</p>
        <p>Status: {{build.status}}</p>
        <p>Build started: {{datetime job.started "Mon Jan 2 15:04:05 MST 2006" "Local"}}</p>
        <p>Build finished: {{datetime job.finished "Mon Jan 2 15:04:05 MST 2006" "Local"}}</p>
      from:
        from_secret: EMAIL_FROM
      recipients:
        from_secret: EMAIL_TO
      recipients_only: true
    when:
      event:
        - tag
        - push
